---
import Layout from '../layouts/Layout.astro';
import {
  profile, publishedPapers, currentDrafts, lesswrongPosts,
  substacks, projects, background
} from '../content/data';
---

<Layout>
  <!-- Hero -->
  <header class="hero">
    <div class="hero-top">
      <img src={profile.photo} alt={profile.name} class="hero-photo" />
      <div class="hero-intro">
        <h1>{profile.name}</h1>
        <p class="affiliations">{profile.affiliations.join(' · ')}</p>
      </div>
    </div>
    <p class="tagline">{profile.tagline}</p>
    <p class="bio">{profile.bio}</p>
    <nav class="links">
      <a href={`mailto:${profile.links.email}`}>Email</a>
      <a href={profile.links.scholar}>Google Scholar</a>
      <a href={profile.links.github}>GitHub</a>
      <a href={profile.links.linkedin}>LinkedIn</a>
      <a href={profile.links.lesswrong}>LessWrong</a>
    </nav>
  </header>

  <!-- About / Philosophy -->
  <div class="about">
    <h2>Approach</h2>
    <p>{profile.philosophy}</p>
    <p>{profile.personal}</p>
    <p class="interests">{profile.interests}</p>
  </div>

  <!-- Two-column: Research (left) | Writing (right) -->
  <div class="columns">
    <!-- LEFT: Research & Drafts -->
    <div class="column">
      <section>
        <h2>Research & Papers</h2>
        {publishedPapers.map((paper) => (
          paper.url ? (
            <a class="card" href={paper.url} target="_blank" rel="noopener noreferrer">
              <div class="card-header">
                <span class="card-title">{paper.title}</span>
                <span class={`card-status ${paper.status}`}>{paper.status === 'published' ? 'Published' : 'Draft'}</span>
              </div>
              <p class="card-desc">{paper.description}</p>
            </a>
          ) : (
            <div class="card">
              <div class="card-header">
                <span class="card-title">{paper.title}</span>
                <span class={`card-status ${paper.status}`}>{paper.status === 'published' ? 'Published' : 'Draft'}</span>
              </div>
              <p class="card-desc">{paper.description}</p>
            </div>
          )
        ))}
        <p class="section-footer">
          Full list on <a href={profile.links.scholar}>Google Scholar</a>
        </p>
      </section>

      <!-- Current Drafts — compact 2-col grid -->
      <section>
        <h2>Current Drafts</h2>
        <div class="draft-grid">
          {currentDrafts.map((draft) => (
            <a class="draft-card" href={draft.pdf} target="_blank" rel="noopener noreferrer">
              <span class="card-title">{draft.title}</span>
              <div class="card-meta">
                <span class={`draft-stage ${draft.stage === 'final' ? 'final' : ''}`}>
                  {draft.stage === 'final' ? 'Final draft' : draft.stage === '2nd' ? '2nd draft' : '1st draft'}
                </span>
                <span class="card-pdf">PDF</span>
              </div>
            </a>
          ))}
        </div>
      </section>

      <!-- Projects -->
      <section>
        <h2>Projects</h2>
        {projects.map((proj) => (
          <a class="card" href={proj.url} target="_blank" rel="noopener noreferrer">
            <div class="card-header">
              <span class="card-title">{proj.name}</span>
              <span class="project-role">{proj.role}</span>
            </div>
            <p class="card-desc">{proj.description}</p>
          </a>
        ))}
      </section>
    </div>

    <!-- RIGHT: Writing -->
    <div class="column">
      <section>
        <h2>Writing</h2>
        <div class="substacks">
          {substacks.map((sub) => (
            <div class="substack-item">
              <a href={sub.url}>{sub.name}</a>
              <p>{sub.description}</p>
            </div>
          ))}
        </div>
      </section>

      <section>
        <h2>LessWrong</h2>
        <ul class="post-list">
          {lesswrongPosts.map((post) => (
            <li>
              <a href={post.url}>{post.title}</a>
              {post.date && <span class="post-date">{post.date}</span>}
            </li>
          ))}
        </ul>
        <p class="section-footer">
          <a href={profile.links.lesswrong}>All posts on LessWrong</a>
        </p>
      </section>
    </div>
  </div>

  <!-- Background -->
  <section>
    <h2>Background</h2>
    <ul class="background-list">
      {background.map((role) => (
        <li>
          <div class="role-header">
            <span class="role-title">{role.title}</span>
            {' — '}
            {role.url ? (
              <a class="role-org" href={role.url}>{role.org}</a>
            ) : (
              <span class="role-org">{role.org}</span>
            )}
          </div>
          <span class="role-period">{role.period}</span>
          {role.description && <p class="role-desc">{role.description}</p>}
        </li>
      ))}
    </ul>
  </section>
</Layout>
